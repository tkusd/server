box: wercker/golang

services:
  - userminddeployer/postgresql9.4@0.0.7-usermind-9.4-3

build:
  steps:
    - setup-go-workspace
    # - wercker/golint

    - script:
        name: Set environment variables
        code: |
          export GO_ENV=wercker
          export GO_CWD=$WERCKER_SOURCE_DIR

    - script:
        name: go get
        code: |
          cd $WERCKER_SOURCE_DIR
          go version
          go get -t ./...

    - script:
        name: Migrate database
        code: |
          go get bitbucket.org/liamstask/goose/cmd/goose
          $GOPATH/bin/goose -env=wercker up

    - script:
        name: go build
        code: |
          go build ./...

    - script:
        name: go test
        code: |
          go test ./...
